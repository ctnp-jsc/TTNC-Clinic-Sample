@page "/forms"
@attribute [Authorize]
@using Sample.ViewModels
@using Sample.Services
@inject FormService FormService
@inject NavigationManager NavManager
<PageTitle>Form List</PageTitle>

<h1>Form List</h1>



@if (listForm == null)

{
  <p><em>Loading...</em></p>
}

else

{
  <div class="col button-top">
    <a href="" onclick="@CreateNewForm" class="btn btn-success">+ Create New</a>
  </div>
  <table class="table">
    <thead>
      <tr>
        <th>Date</th>
        <th>Last Edited</th>
        <th>Title</th>
        <th>Status</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody>
      @foreach (var form in listForm)

      {
        <tr >
          <td @onclick="(()=>OnClickRowForm(form.Id))">@form.CreatedAt</td>
          <td @onclick="(()=>OnClickRowForm(form.Id))">@form.LastEdited</td>
          <td @onclick="(()=>OnClickRowForm(form.Id))">@form.Title</td>
          <td @onclick="(()=>OnClickRowForm(form.Id))">@form.FormStatus</td>
          <td>
            <a href="javascript:void(0);" @onclick="()=>DeleteForm(form.Id)"><i class="fas fa-trash-alt"></i></a>
            <a href="javascript:void(0);" @onclick="()=>ExportForm(form.Id)" style="margin-left: 12px;"><i class="fas fa-file-export"></i></a>
          </td>
        </tr>
      }
    </tbody>
  </table>
  <div class="modal" tabindex="-1" role="dialog" style="display: @(showDeleteConfirmation ? "block" : "none")">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Confirm Delete</h5>
                <button type="button" class="close" data-dismiss="modal" @onclick="CloseDeleteConfirmation">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to delete this form?</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal" @onclick="CloseDeleteConfirmation">Cancel</button>
                <button type="button" class="btn btn-danger" @onclick="ConfirmDelete">Delete</button>
            </div>
        </div>
    </div>
</div>

}

@code {
  private List<FormViewModel>? listForm;
  private bool showDeleteConfirmation = false;
  private string formIdToDelete;



  protected override async Task OnInitializedAsync()

  {

    listForm = await FormService.GetListForm();

  }

  private async Task CreateNewForm()
  {
    var form = await FormService.CreateForm(new ViewModels.FormViewModel() { Title = "Health Risk Assessment" });
    NavManager.NavigateTo($"/formcreate/{form.Id}");
  }
  private void OnClickRowForm(string formId)
  {
    NavManager.NavigateTo($"/formcreate/{formId}");
  }

  private async Task ExportForm (string FormId){

  }
  private void DeleteForm(string FormId)
  {
      formIdToDelete = FormId;
      showDeleteConfirmation = true;
  }
  private void CloseDeleteConfirmation()
{
    showDeleteConfirmation = false;
}

private async void ConfirmDelete()
{
    await FormService.DeleteForm(formIdToDelete);
    listForm = await FormService.GetListForm();
    showDeleteConfirmation = false;
}

}
